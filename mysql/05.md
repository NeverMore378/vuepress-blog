---
title: function
categories:
 - mysql
---

### 存储过程和函数区别

- 存储过程的参数列表可以有输入参数、输出参数、可输入输出的参数；函数的参数列表只有输入参数

- 存储过程的返回值，可以有多个值；函数的返回值，只有一个值

- 不同之处是函数必须指定返回类型

- 过程和函数，它们被编译后保存在数据库中，可以反复调用，运行速度快

- 存储过程的调用方式
    - exec <过程名>
    - execute <过程名>
    - 直接调用

- 函数的调用方式：直接调用

### 存储过程的优点

- 存储过程只在创造时进行编译，以后每次执行存储过程都不需再重新编译，而一般SQL语句每执行一次就编译一次,所以使用存储过程可提高数据库执行速度

### 存储过程
- 存储过程相当于是定义在 MySQL 中的方法，开发者可以直接调用

创建存储过程(入参)

```sql
create procedure add_name(in target int)
begin
declare name varchar(11);
if target = 1 then
set name = 'MySQL';
else
set name = 'Java';
end if;
insert into student(name) values(name);
end;
```
```sql
call add_name(2) # 插入student表，数据为Java
```

创建存储过程(出参)
```sql
create procedure count_of_student(out count_num int)
begin
select count(1) into count_num from student;
end;
```

### 视图和表

- 视图是已经编译好的sql语句，而表不是 

- 表占用物理空间而视图不占用物理空间，视图只是逻辑概念的存在，表可以及时对它进行修改，但视图只能有创建的语句来修改

- 视图（view）是在基本表之上建立的表，它的结构（即所定义的列）和内容（即所有数据行）都来自基本表，它依据基本表存在而存在

### 触发器

- 当表中的数据出现增删改的时候，就会触发触发器，执行自己定义的sql语句

### sql函数

- 数学函数

```sql
select abs(score) from course where id = 1;
select count(score) from course where id = 1;
select avg(score) from course where id = 1;
select sum(score) from course where id = 1;
select max(score) from course where id = 1;
select min(score) from course where id = 1;
```

- 字符串函数
```sql
select concat(score,',',name) from course where id = 1;
update table set code = replace(code,'.0','') where code like '%.0' # 将所有code中以.0结尾的去除掉
```

- 日期函数

```sql
select curdate(); # 2021-08-17
select curtime(); # 09:10:22
select now(); # 2021-08-17 09:10:29
select * from table where date(date_time) between '2021-08-04' and '2021-08-17';
select date_format(date_time, '%Y%m%d%H%i%s') time from table where id = 1
```

- 高级函数
```sql
IFNULL(v1,v2)
USER()
DATABASE()
SELECT CAST("2021-08-29" AS DATE);
```

